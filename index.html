<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">
  <title>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼ã‚¹</title>
  <meta name="description" content="æœ€æ–°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»å‹•ç”»ã‚’åé›†ãƒ»é–²è¦§ã™ã‚‹ã‚¢ãƒ—ãƒª">
  <meta name="theme-color" content="#1e40af">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SecNews">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #0f172a; --bg-card: #1e293b; --bg-hover: #334155;
      --text: #f1f5f9; --text-dim: #94a3b8;
      --accent: #3b82f6; --accent-dark: #1e40af;
      --border: #334155;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    html { font-size: 16px; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", sans-serif;
      background: var(--bg); color: var(--text);
      min-height: 100dvh; -webkit-font-smoothing: antialiased;
    }
    .app { max-width: 480px; margin: 0 auto; padding-top: var(--safe-top); padding-bottom: calc(72px + var(--safe-bottom)); }
    .header { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 16px 20px 12px; border-bottom: 1px solid var(--border); }
    .header h1 { font-size: 1.4rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }
    .header h1 svg { width: 28px; height: 28px; }
    .header .subtitle { font-size: 0.8rem; color: var(--text-dim); margin-top: 4px; }
    .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; background: var(--bg-card); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 8px 0 calc(8px + var(--safe-bottom)); }
    .tab-btn { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 6px; background: none; border: none; color: var(--text-dim); font-size: 0.65rem; cursor: pointer; transition: color 0.2s; }
    .tab-btn.active { color: var(--accent); }
    .tab-btn svg { width: 22px; height: 22px; }
    .content { padding: 12px 16px; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .filters { display: flex; gap: 8px; padding: 8px 0 12px; overflow-x: auto; }
    .filter-btn { flex-shrink: 0; padding: 6px 14px; border-radius: 99px; border: 1px solid var(--border); background: none; color: var(--text-dim); font-size: 0.75rem; cursor: pointer; transition: all 0.2s; }
    .filter-btn.active { background: var(--accent); border-color: var(--accent); color: white; }
    .card { background: var(--bg-card); border-radius: 12px; padding: 14px 16px; margin-bottom: 10px; border: 1px solid var(--border); text-decoration: none; color: inherit; display: block; transition: background 0.2s; }
    .card:active { background: var(--bg-hover); }
    .card-title { font-size: 0.95rem; font-weight: 600; line-height: 1.4; margin-bottom: 6px; }
    .card-meta { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 6px; }
    .card-summary { font-size: 0.8rem; color: var(--text-dim); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .badge { font-size: 0.65rem; padding: 2px 8px; border-radius: 99px; font-weight: 600; }
    .badge-source { background: var(--accent-dark); color: #dbeafe; }
    .badge-ja { background: #1e3a5f; color: #93c5fd; }
    .badge-en { background: #14532d; color: #86efac; }
    .badge-date { background: var(--bg); color: var(--text-dim); }
    .badge-category { background: #581c87; color: #d8b4fe; }
    .badge-platform { background: #7f1d1d; color: #fca5a5; }
    .site-card { display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); border-radius: 12px; padding: 14px 16px; margin-bottom: 10px; border: 1px solid var(--border); }
    .site-info { flex: 1; }
    .site-name { font-weight: 600; font-size: 0.9rem; }
    .site-url { font-size: 0.75rem; color: var(--text-dim); word-break: break-all; }
    .site-toggle { width: 44px; height: 24px; background: var(--border); border-radius: 12px; border: none; position: relative; cursor: pointer; flex-shrink: 0; margin-left: 12px; transition: background 0.3s; }
    .site-toggle.on { background: #22c55e; }
    .site-toggle::after { content: ""; width: 20px; height: 20px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: transform 0.3s; }
    .site-toggle.on::after { transform: translateX(20px); }
    .loading { display: flex; justify-content: center; padding: 40px; }
    .spinner { width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error-msg { text-align: center; padding: 40px 20px; color: #ef4444; font-size: 0.9rem; }
    .count { font-size: 0.8rem; color: var(--text-dim); padding: 4px 0 8px; }
    .note { font-size: 0.75rem; color: #64748b; text-align: center; padding: 12px; }
    .updated { font-size: 0.7rem; color: var(--text-dim); text-align: right; padding: 4px 0; }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <h1>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼ã‚¹
      </h1>
      <p class="subtitle">æœ€æ–°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã‚’ã¾ã¨ã‚ã¦ãƒã‚§ãƒƒã‚¯</p>
    </header>

    <main class="content">
      <div id="tab-articles" class="tab-content active">
        <div class="filters">
          <button class="filter-btn active" data-filter="all" onclick="setFilter('articles','all')">ã™ã¹ã¦</button>
          <button class="filter-btn" data-filter="ja" onclick="setFilter('articles','ja')">æ—¥æœ¬èª</button>
          <button class="filter-btn" data-filter="en" onclick="setFilter('articles','en')">è‹±èª</button>
        </div>
        <div id="articles-updated" class="updated"></div>
        <div id="articles-count" class="count"></div>
        <div id="articles-list"></div>
      </div>

      <div id="tab-videos" class="tab-content">
        <div class="filters">
          <button class="filter-btn active" data-filter="all" onclick="setFilter('videos','all')">ã™ã¹ã¦</button>
          <button class="filter-btn" data-filter="ja" onclick="setFilter('videos','ja')">æ—¥æœ¬èª</button>
          <button class="filter-btn" data-filter="en" onclick="setFilter('videos','en')">è‹±èª</button>
        </div>
        <div id="videos-updated" class="updated"></div>
        <div id="videos-count" class="count"></div>
        <div id="videos-list"></div>
      </div>

      <div id="tab-sites" class="tab-content">
        <div id="sites-list"></div>
        <p class="note">ã‚µã‚¤ãƒˆã®è¿½åŠ ãƒ»å‰Šé™¤ã¯Notionã‚¢ãƒ—ãƒªã‹ã‚‰è¡Œãˆã¾ã™</p>
      </div>
    </main>

    <nav class="tab-bar">
      <button class="tab-btn active" onclick="switchTab('articles')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
        è¨˜äº‹
      </button>
      <button class="tab-btn" onclick="switchTab('videos')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
        å‹•ç”»
      </button>
      <button class="tab-btn" onclick="switchTab('sites')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        ã‚µã‚¤ãƒˆç®¡ç†
      </button>
    </nav>
  </div>

  <script>
    let data = { articles: [], videos: [], sites: [], updated: "" };
    let currentTab = "articles";
    let filters = { articles: "all", videos: "all" };

    async function loadData() {
      try {
        const res = await fetch("data/articles.json");
        if (res.ok) { const json = await res.json(); data.articles = json.articles || []; data.updated = json.updated || ""; }
      } catch (e) { console.log("è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ãªã—"); }
      try {
        const res = await fetch("data/videos.json");
        if (res.ok) { const json = await res.json(); data.videos = json.videos || []; }
      } catch (e) { console.log("å‹•ç”»ãƒ‡ãƒ¼ã‚¿ãªã—"); }
      try {
        const res = await fetch("data/sites.json");
        if (res.ok) { const json = await res.json(); data.sites = json.sites || []; }
      } catch (e) { console.log("ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ãªã—"); }
      render();
    }

    function switchTab(tab) {
      currentTab = tab;
      document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
      document.getElementById("tab-" + tab).classList.add("active");
      document.querySelectorAll(".tab-btn").forEach((btn, i) => {
        btn.classList.toggle("active", ["articles", "videos", "sites"][i] === tab);
      });
    }

    function setFilter(tab, value) {
      filters[tab] = value;
      const container = document.getElementById("tab-" + tab);
      container.querySelectorAll(".filter-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.filter === value);
      });
      render();
    }

    function applyFilter(items, tab) {
      const f = filters[tab];
      if (f === "all") return items;
      if (f === "ja") return items.filter(i => i.language === "æ—¥æœ¬èª");
      if (f === "en") return items.filter(i => i.language === "è‹±èª");
      return items;
    }

    function render() { renderArticles(); renderVideos(); renderSites(); }

    function renderArticles() {
      const filtered = applyFilter(data.articles, "articles");
      document.getElementById("articles-updated").textContent = data.updated ? "æœ€çµ‚æ›´æ–°: " + data.updated : "";
      document.getElementById("articles-count").textContent = filtered.length + "ä»¶ã®è¨˜äº‹";
      const listEl = document.getElementById("articles-list");
      if (filtered.length === 0) { listEl.innerHTML = '<p class="error-msg">è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“</p>'; return; }
      listEl.innerHTML = filtered.map(a => '<a href="'+a.url+'" target="_blank" rel="noopener noreferrer" class="card"><div class="card-title">'+esc(a.title)+' â†—</div><div class="card-meta"><span class="badge badge-source">'+esc(a.source)+'</span><span class="badge badge-'+(a.language==="æ—¥æœ¬èª"?"ja":"en")+'">'+esc(a.language)+'</span><span class="badge badge-date">'+esc(a.date)+'</span></div><div class="card-summary">'+esc(a.summary)+'</div></a>').join("");
    }

    function renderVideos() {
      const filtered = applyFilter(data.videos, "videos");
      document.getElementById("videos-count").textContent = filtered.length + "ä»¶ã®å‹•ç”»";
      const listEl = document.getElementById("videos-list");
      if (filtered.length === 0) { listEl.innerHTML = '<p class="error-msg">å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“</p>'; return; }
      listEl.innerHTML = filtered.map(v => '<a href="'+v.url+'" target="_blank" rel="noopener noreferrer" class="card"><div class="card-title">'+esc(v.title)+' â†—</div><div class="card-meta"><span class="badge badge-category">'+esc(v.category)+'</span><span class="badge badge-platform">'+esc(v.platform)+'</span><span class="badge badge-'+(v.language==="æ—¥æœ¬èª"?"ja":"en")+'">'+esc(v.language)+'</span><span class="badge badge-date">'+esc(v.date)+'</span></div><div class="card-summary">'+(v.channel?"ğŸ“º "+esc(v.channel):"")+(v.channel&&v.summary?" â€” ":"")+esc(v.summary)+'</div></a>').join("");
    }

    function renderSites() {
      const listEl = document.getElementById("sites-list");
      if (data.sites.length === 0) { listEl.innerHTML = '<p class="error-msg">ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>'; return; }
      listEl.innerHTML = data.sites.map(s => '<div class="site-card"><div class="site-info"><div class="site-name">'+esc(s.name)+'</div><div class="site-url">'+esc(s.url)+'</div><div class="card-meta" style="margin-top:4px"><span class="badge badge-'+(s.category==="æ—¥æœ¬èª"?"ja":"en")+'">'+esc(s.category)+'</span></div></div><div class="site-toggle '+(s.enabled?"on":"")+'"></div></div>').join("");
    }

    function esc(str) { if (!str) return ""; return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"); }

    if ("serviceWorker" in navigator) { navigator.serviceWorker.register("sw.js"); }
    loadData();
  </script>
</body>
</html>
